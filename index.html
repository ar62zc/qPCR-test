<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>qPCR Master Mind v4.0</title>
    
    <!-- Ê†∏ÂøÉÂ∫´ÔºöReact, ReactDOM, Babel, Tailwind -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Êõ¥Êñ∞ Babel ÁâàÊú¨‰ª•Á¢∫‰øùÁõ∏ÂÆπÊÄß -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }
        .fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">

    <div id="root"></div>

    <script type="text/babel">
        const { useState } = React;

        // ==========================================
        // üé® ÂÖßÂª∫ÂúñÊ®ôÂÖÉ‰ª∂ (SVG)
        // Ëß£Ê±∫Â§ñÈÉ®‰æùË≥¥Â∞éËá¥ÁôΩÁï´Èù¢ÁöÑÂïèÈ°å
        // ==========================================
        const IconBase = ({ children, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                {children}
            </svg>
        );

        const Calculator = (props) => (
            <IconBase {...props}><rect width="16" height="20" x="4" y="2" rx="2"/><line x1="8" x2="16" y1="6" y2="6"/><line x1="16" x2="16" y1="14" y2="18"/><path d="M16 10h.01"/><path d="M12 10h.01"/><path d="M8 10h.01"/><path d="M12 14h.01"/><path d="M8 14h.01"/><path d="M12 18h.01"/><path d="M8 18h.01"/></IconBase>
        );
        const Settings = (props) => (
            <IconBase {...props}><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.47a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.39a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></IconBase>
        );
        const Beaker = (props) => (
            <IconBase {...props}><path d="M4.5 3h15"/><path d="M6 3v16a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V3"/><path d="M6 14h12"/></IconBase>
        );
        const TestTube = (props) => (
            <IconBase {...props}><path d="M14.5 2v17.5c0 1.4-1.1 2.5-2.5 2.5h0c-1.4 0-2.5-1.1-2.5-2.5V2"/><path d="M8.5 2h7"/><path d="M14.5 16h-5"/></IconBase>
        );
        const AlertCircle = (props) => (
            <IconBase {...props}><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="12"/><line x1="12" x2="12.01" y1="16" y2="16"/></IconBase>
        );
        const Droplet = (props) => (
            <IconBase {...props}><path d="M12 22a7 7 0 0 0 7-7c0-2-1-3.9-3-5.5s-3.5-4-4-6.5c-.5 2.5-2 4.9-4 6.5C6 11.1 5 13 5 15a7 7 0 0 0 7 7z"/></IconBase>
        );
        const Info = (props) => (
            <IconBase {...props}><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></IconBase>
        );
        const FlaskConical = (props) => (
            <IconBase {...props}><path d="M10 2v7.527a2 2 0 0 1-.211.896L4.72 20.55a1 1 0 0 0 .9 1.45h12.76a1 1 0 0 0 .9-1.45l-5.069-10.127A2 2 0 0 1 14 9.527V2"/><path d="M8.5 2h7"/><path d="M7 16h10"/></IconBase>
        );
        const AlertTriangle = (props) => (
            <IconBase {...props}><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><path d="M12 9v4"/><path d="M12 17h.01"/></IconBase>
        );
        const Syringe = (props) => (
            <IconBase {...props}><path d="m18 2 4 4"/><path d="m17 7 3-3"/><path d="M19 9 8.7 19.3c-1 1-2.5 1-3.4 0l-.6-.6c-1-1-1-2.5 0-3.4L15 5"/><path d="m9 11 4 4"/><path d="m5 19-3 3"/><path d="m14 4 6 6"/></IconBase>
        );
        const Globe = (props) => (
            <IconBase {...props}><circle cx="12" cy="12" r="10"/><path d="M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20"/><path d="M2 12h20"/></IconBase>
        );


        // ==========================================
        // üìù ÊñáÊ°àË®≠ÂÆöÂçÄ
        // ==========================================
        const translations = {
            zh: {
                appTitle: "qPCR Master Mind v4.0",
                appSubtitle: "Ëá™ÂãïË®àÁÆó cDNA Á®ÄÈáãÁ≠ñÁï•Ëàá Master Mix ÈÖçÊñπ",
                resetBtn: "ÈáçÁΩÆÂèÉÊï∏",
                inputsTitle: "ÂØ¶È©óÂèÉÊï∏ (Inputs)",
                labelMass: "RT ÊäïÂÖ• RNA Á∏ΩÈáè (A)",
                subMass: "cDNA ÊèõÁÆóÊøÉÂ∫¶:",
                labelGene: "Âü∫Âõ†Êï∏Èáè (Genes)",
                labelSample: "Ê®£Êú¨Êï∏Èáè (Samples)",
                labelRep: "ÈáçË§áÊï∏ (Replicates)",
                labelWellVol: "cDNA ÊØèÂ≠îÈ´îÁ©ç",
                advancedSettings: "ÈÄ≤ÈöéË®≠ÂÆö (Target & Loss)",
                labelRTVol: "cDNA Á∏ΩÈ´îÁ©ç (RT Volume)",
                subRTVol: "È†êË®≠ 20 ŒºL",
                labelTarget: "ÁõÆÊ®ô‰∏äÊ®£Èáè (Mass/Well)",
                subTarget: "ÁØÑÂúç: 1 - 10 ng",
                labelWorkLoss: "Â∑•‰ΩúÊ∂≤ÊêçËÄó (Work Loss)",
                labelMixLoss: "MM ÊêçËÄó (Mix Loss)",
                infoTitle: "ÁõÆÂâçË®≠ÂÆö",
                infoTarget: "ÊØèÂ≠îÁõÆÊ®ôÈáè",
                infoConc: "Â∑•‰ΩúÊøÉÂ∫¶",
                infoNote: "* Á≥ªÁµ±ÂÅáË®≠ RT ÂèçÊáâÂæåÁ∏ΩÈ´îÁ©çÁÇ∫",
                dilutionTitle: "Sample Á®ÄÈáãÈÖçÊñπ",
                modeA_Title: "Ê®ôÊ∫ñÂÖ©ÊÆµÂºèÁ®ÄÈáã (Standard)",
                modeA_Desc: "RNAÈáèÂÖÖË∂≥ (‚â•400ng)ÔºåÊé°ÂÖ©ÊÆµÁ®ÄÈáã„ÄÇÂÖàÈÖçË£Ω‰∏≠Èñì StockÔºåÂÜçÁ®ÄÈáã 10 ÂÄç„ÄÇ",
                modeB_Title: "Á≤æÊ∫ñÁõ¥ÈÖçÊ®°Âºè (Direct)",
                modeB_Desc: "RNAÈáèËºÉ‰Ωé (<400ng)Ôºå‰∏çÈÄ≤Ë°å‰∏≠ÈñìÁ®ÄÈáãÔºåÁõ¥Êé•‰æùÊøÉÂ∫¶Ë®àÁÆóÂéüÊ∂≤ÂèñÁî®Èáè„ÄÇ",
                warnTitle: "cDNA ÂéüÊ∂≤‰∏çË∂≥ÔºÅ",
                warnDesc: "Ë®àÁÆóÈúÄÊ±ÇÈáèË∂ÖÈÅéÊÇ®ÁöÑ RT Áî¢Áâ©Á∏ΩÈáè„ÄÇË´ãÊ™¢Êü•ÂØ¶È©óË®≠Ë®àÊàñÊ∏õÂ∞ëÊêçËÄó‰øÇÊï∏„ÄÇ",
                warnTag: "Â∫´Â≠ò‰∏çË∂≥",
                step1: "Ê≠•È©ü 1: ÈÖçË£Ω Stock Solution",
                step2: "Ê≠•È©ü 2: ÈÖçË£Ω Working Solution",
                step2_Direct: "Ê≠•È©ü 1: Áõ¥Êé•ÈÖçË£Ω Working Solution",
                targetLabel: "ÁõÆÊ®ô",
                sourceCDNA: "Âèñ cDNA ÂéüÊ∂≤",
                addWater: "Âä†ÂÖ•ÁÑ°ËèåÊ∞¥",
                totalVol: "Á∏ΩÈ´îÁ©ç",
                takeStock: "Âèñ Stock",
                takeSource: "Âèñ",
                distributeNote: "ÂàÜË£ùËá≥",
                tubes: "ÂÄãÁÆ°",
                mmTitle: "Master Mix ÈÖçÊñπË°® (ÂñÆ‰∏ÄÂü∫Âõ†)",
                mmDesc: "ÈÖçË£ΩÂÆåÊàêÂæåÔºåÂàÜË£ù 12 ŒºL Ëá≥ÂêÑÂÄã Well ‰∏≠„ÄÇ",
                rxn: "ÂèçÊáâÊï∏ (Rxn)",
                colComponent: "ÊàêÂàÜ (Component)",
                colSingle: "ÂñÆÊ¨°Èáè",
                colTotal: "Á∏ΩÈ´îÁ©ç (ŒºL)",
                totalMixVol: "Total Mix Volume",
                footerNote: "ÊØèÂ≠î: ",
                footerTotal: " Total"
            },
            en: {
                appTitle: "qPCR Master Mind v4.0",
                appSubtitle: "Auto-calculation for cDNA dilution & Master Mix",
                resetBtn: "Reset",
                inputsTitle: "Parameters (Inputs)",
                labelMass: "Total RNA for RT (A)",
                subMass: "cDNA Conc:",
                labelGene: "Gene Count (G)",
                labelSample: "Sample Count (S)",
                labelRep: "Replicates (R)",
                labelWellVol: "cDNA Vol/Well",
                advancedSettings: "Advanced (Target & Loss)",
                labelRTVol: "Total RT Volume",
                subRTVol: "Default 20 ŒºL",
                labelTarget: "Target Mass/Well",
                subTarget: "Range: 1 - 10 ng",
                labelWorkLoss: "Work Loss Factor",
                labelMixLoss: "MM Loss Factor",
                infoTitle: "Current Settings",
                infoTarget: "Target Mass",
                infoConc: "Working Conc",
                infoNote: "* Assuming RT total volume is",
                dilutionTitle: "Sample Dilution Plan",
                modeA_Title: "Standard Mode (Two-step)",
                modeA_Desc: "High RNA (‚â•400ng). Create intermediate Stock, then dilute 10x.",
                modeB_Title: "Direct Mode (Precision)",
                modeB_Desc: "Low RNA (<400ng). Calculate direct dilution volume for precision.",
                warnTitle: "Insufficient cDNA!",
                warnDesc: "Required volume exceeds your total RT product. Please check design.",
                warnTag: "Insufficient Vol",
                step1: "Step 1: Prepare Stock Solution",
                step2: "Step 2: Prepare Working Solution",
                step2_Direct: "Step 1: Prepare Working Solution",
                targetLabel: "Target",
                sourceCDNA: "Take cDNA",
                addWater: "Add Water",
                totalVol: "Total Vol",
                takeStock: "Take Stock",
                takeSource: "Take",
                distributeNote: "Distribute to",
                tubes: "tubes",
                mmTitle: "Master Mix Recipe (Per Gene)",
                mmDesc: "After mixing, dispense 12 ŒºL into each well.",
                rxn: "Rxns",
                colComponent: "Component",
                colSingle: "Per Rxn",
                colTotal: "Total (ŒºL)",
                totalMixVol: "Total Mix Volume",
                footerNote: "Per Well: ",
                footerTotal: " Total"
            }
        };

        const Card = ({ children, className = "" }) => (
            <div className={`bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden ${className}`}>
                {children}
            </div>
        );

        const CardHeader = ({ title, icon: Icon, color = "text-slate-700" }) => (
            <div className="px-6 py-4 border-b border-slate-100 flex items-center gap-2 bg-slate-50/50">
                {Icon && <Icon className={`w-5 h-5 ${color}`} />}
                <h3 className="font-bold text-slate-800">{title}</h3>
            </div>
        );

        const CardContent = ({ children, className = "" }) => (
            <div className={`p-6 ${className}`}>
                {children}
            </div>
        );

        const InputGroup = ({ label, value, onChange, min, max, step = 1, unit, subtext, warning }) => (
            <div className="flex flex-col gap-1">
                <label className="text-sm font-semibold text-slate-600 flex justify-between items-center">
                <span>{label}</span>
                {unit && <span className="text-slate-400 font-normal">{unit}</span>}
                </label>
                <div className="relative">
                <input
                    type="number"
                    value={value}
                    onChange={(e) => onChange(parseFloat(e.target.value) || 0)}
                    className={`w-full px-3 py-2 border rounded-lg focus:ring-2 outline-none transition-all text-slate-800 font-medium ${
                    warning 
                        ? "border-red-300 focus:ring-red-200 bg-red-50 text-red-700" 
                        : "border-slate-300 focus:ring-emerald-500 focus:border-emerald-500"
                    }`}
                    min={min}
                    max={max}
                    step={step}
                />
                </div>
                {subtext && <span className={`text-xs ${warning ? 'text-red-500 font-bold' : 'text-slate-400'}`}>{subtext}</span>}
            </div>
        );

        const ResultBox = ({ label, value, unit, highlight = false, warning = false, warningText }) => (
            <div className={`rounded-lg p-3 border transition-colors ${
                warning 
                ? 'bg-red-50 border-red-300 shadow-sm ring-1 ring-red-200' 
                : highlight 
                    ? 'bg-white border-blue-300 shadow-sm' 
                    : 'bg-slate-50 border-slate-200'
            }`}>
                <div className={`text-xs mb-1 flex justify-between ${warning ? 'text-red-700 font-bold' : 'text-slate-500'}`}>
                {label}
                {warning && <AlertTriangle className="w-3 h-3 text-red-600 animate-bounce" />}
                </div>
                <div className={`text-xl font-mono font-bold flex items-center gap-1 ${
                warning ? 'text-red-600' : highlight ? 'text-blue-600' : 'text-slate-700'
                }`}>
                {Number(value).toLocaleString(undefined, { maximumFractionDigits: 1 })}
                <span className={`text-sm font-normal ml-1 ${warning ? 'text-red-400' : 'text-slate-400'}`}>{unit}</span>
                </div>
                {warning && (
                <div className="text-[10px] text-red-600 mt-1 font-bold bg-red-100 px-1 py-0.5 rounded w-fit">
                    {warningText}
                </div>
                )}
            </div>
        );

        function App() {
            const [lang, setLang] = useState('zh');
            const t = translations[lang];

            const [rnaMass, setRnaMass] = useState(1000);   
            const [cDNAVol, setCDNAVol] = useState(20);     
            const [geneCount, setGeneCount] = useState(3);  
            const [sampleCount, setSampleCount] = useState(6); 
            const [replicates, setReplicates] = useState(2); 
            const [wellVol, setWellVol] = useState(8);      
            const [targetMass, setTargetMass] = useState(4);   
            const [workLossFactor, setWorkLossFactor] = useState(1.25);
            const [mixLossFactor, setMixLossFactor] = useState(1.1);
            const [showAdvanced, setShowAdvanced] = useState(false);

            const cDNAConc = rnaMass / cDNAVol;
            const targetConc = targetMass / wellVol; 
            const totalWorkVolNeeded = (geneCount * replicates * wellVol) * workLossFactor;
            const isHighMass = rnaMass >= 400;
            const CDNA_LIMIT_VOL = cDNAVol; 
            const MIN_PIPETTE_VOL = 2;

            let dilutionPlan = {};

            if (isHighMass) {
                const intermediateFactor = 10;
                const stockTargetConc = targetConc * intermediateFactor; 
                const stockNeededForWork = totalWorkVolNeeded / intermediateFactor;
                let rawVOrig = (stockTargetConc * stockNeededForWork) / cDNAConc;
                let vOrig = Math.max(MIN_PIPETTE_VOL, Math.ceil(rawVOrig * 10) / 10);
                const stockTotalVol = (cDNAConc * vOrig) / stockTargetConc;
                const stockWater = stockTotalVol - vOrig;
                const isInsufficient = vOrig > CDNA_LIMIT_VOL;
                const workWater = totalWorkVolNeeded - stockNeededForWork;

                dilutionPlan = {
                    mode: 'A',
                    title: t.modeA_Title,
                    description: t.modeA_Desc,
                    isInsufficient,
                    step1: {
                        label: t.step1,
                        targetLabel: `${t.targetLabel}: ${stockTargetConc.toFixed(2)} ng/ŒºL`,
                        cDNA: vOrig,
                        water: stockWater,
                        total: stockTotalVol,
                    },
                    step2: {
                        label: t.step2,
                        targetLabel: `${t.targetLabel}: ${targetConc.toFixed(2)} ng/ŒºL`,
                        sourceVol: stockNeededForWork,
                        sourceName: t.takeStock,
                        water: workWater,
                        total: totalWorkVolNeeded
                    }
                };
            } else {
                let rawVOrig = (targetConc * totalWorkVolNeeded) / cDNAConc;
                let vOrig = rawVOrig;
                let finalTotalVol = totalWorkVolNeeded;
                if (vOrig < MIN_PIPETTE_VOL) {
                    vOrig = MIN_PIPETTE_VOL;
                    finalTotalVol = (cDNAConc * vOrig) / targetConc;
                } else {
                    vOrig = Math.ceil(rawVOrig * 10) / 10;
                    finalTotalVol = (cDNAConc * vOrig) / targetConc;
                }
                const waterNeeded = finalTotalVol - vOrig;
                const isInsufficient = vOrig > CDNA_LIMIT_VOL;

                dilutionPlan = {
                    mode: 'B',
                    title: t.modeB_Title,
                    description: t.modeB_Desc,
                    isInsufficient,
                    step1: null,
                    step2: {
                        label: t.step2_Direct,
                        targetLabel: `${t.targetLabel}: ${targetConc.toFixed(2)} ng/ŒºL`,
                        sourceVol: vOrig,
                        sourceName: `${t.takeSource} cDNA`,
                        water: waterNeeded,
                        total: finalTotalVol
                    }
                };
            }

            const rxnNumRaw = sampleCount * replicates;
            const rxnNum = rxnNumRaw * mixLossFactor;
            const displayRxnNum = Math.ceil(rxnNum * 10) / 10; 

            const masterMix = {
                sybr: displayRxnNum * 10,
                fPrimer: displayRxnNum * 1,
                rPrimer: displayRxnNum * 1,
                totalPerGene: displayRxnNum * 12
            };

            return (
                <div className="min-h-screen bg-slate-50 p-4 font-sans text-slate-800 fade-in">
                <div className="max-w-5xl mx-auto space-y-6">
                    <header className="flex flex-col md:flex-row md:items-center justify-between gap-4 pb-4 border-b border-slate-200">
                    <div className="flex-1">
                        <h1 className="text-2xl md:text-3xl font-bold text-emerald-800 flex items-center gap-2">
                        <Calculator className="w-8 h-8" />
                        {t.appTitle}
                        </h1>
                        <p className="text-slate-500 mt-1">{t.appSubtitle}</p>
                    </div>
                    <div className="flex items-center gap-3">
                        <button 
                            onClick={() => setLang(l => l === 'zh' ? 'en' : 'zh')}
                            className="flex items-center gap-2 px-3 py-2 text-sm font-bold text-emerald-700 bg-emerald-100 rounded-lg hover:bg-emerald-200 transition-colors"
                        >
                            <Globe className="w-4 h-4" />
                            {lang === 'zh' ? 'EN' : '‰∏≠Êñá'}
                        </button>
                        <button 
                            onClick={() => {
                            setRnaMass(1000); setGeneCount(3); setSampleCount(6);
                            setReplicates(2); setWorkLossFactor(1.25); setMixLossFactor(1.1); setTargetMass(4);
                            }}
                            className="px-4 py-2 text-sm bg-white border border-slate-300 hover:bg-slate-50 text-slate-600 rounded-lg shadow-sm transition-colors"
                        >
                            {t.resetBtn}
                        </button>
                    </div>
                    </header>
                    <div className="grid grid-cols-1 lg:grid-cols-12 gap-6">
                    <div className="lg:col-span-4 space-y-6">
                        <Card>
                        <CardHeader title={t.inputsTitle} icon={Settings} />
                        <CardContent className="space-y-5">
                            <InputGroup 
                            label={t.labelMass} unit="ng" 
                            value={rnaMass} onChange={setRnaMass} min={1} step={50}
                            subtext={<span className="flex items-center gap-1"><Syringe className="w-3 h-3"/> {t.subMass} <b>{cDNAConc.toFixed(1)} ng/ŒºL</b></span>}
                            />
                            <InputGroup label={t.labelGene} unit="Genes" value={geneCount} onChange={setGeneCount} min={1} />
                            <InputGroup label={t.labelSample} unit="Samples" value={sampleCount} onChange={setSampleCount} min={1} />
                            <div className="grid grid-cols-2 gap-4">
                            <InputGroup label={t.labelRep} value={replicates} onChange={setReplicates} min={1} />
                            <InputGroup label={t.labelWellVol} unit="ŒºL" value={wellVol} onChange={setWellVol} min={1} />
                            </div>
                            <div className="pt-4 border-t border-slate-100">
                            <button 
                                onClick={() => setShowAdvanced(!showAdvanced)}
                                className="flex items-center gap-2 text-sm font-semibold text-emerald-700 hover:text-emerald-900 transition-colors w-full justify-between bg-emerald-50 p-2 rounded-lg"
                            >
                                <span>{t.advancedSettings}</span>
                                <Settings className="w-4 h-4" />
                            </button>
                            {showAdvanced && (
                                <div className="mt-4 grid grid-cols-1 gap-4 bg-slate-50 p-3 rounded-lg border border-slate-100 animate-in fade-in slide-in-from-top-2">
                                <InputGroup label={t.labelRTVol} unit="ŒºL" value={cDNAVol} onChange={setCDNAVol} min={10} max={100} subtext={t.subRTVol} />
                                <InputGroup label={t.labelTarget} unit="ng" value={targetMass} onChange={setTargetMass} min={1} max={20} step={0.5} subtext={t.subTarget} />
                                <InputGroup label={t.labelWorkLoss} value={workLossFactor} onChange={setWorkLossFactor} step={0.05} />
                                <InputGroup label={t.labelMixLoss} value={mixLossFactor} onChange={setMixLossFactor} step={0.05} />
                                </div>
                            )}
                            </div>
                        </CardContent>
                        </Card>
                        <div className="bg-emerald-50 rounded-xl p-4 border border-emerald-100 text-emerald-800 text-sm flex gap-3">
                        <Info className="w-5 h-5 shrink-0 mt-0.5" />
                        <div>
                            <p className="font-bold mb-1">{t.infoTitle}</p>
                            <p>{t.infoTarget}: <strong>{targetMass} ng</strong></p>
                            <p>{t.infoConc}: <strong>{targetConc.toFixed(2)} ng/ŒºL</strong></p>
                            <p className="mt-2 text-emerald-600/80 text-xs border-t border-emerald-200 pt-1">
                            {t.infoNote} {cDNAVol} ŒºL
                            </p>
                        </div>
                        </div>
                    </div>
                    <div className="lg:col-span-8 space-y-6">
                        <Card className={`border-t-4 ${isHighMass ? 'border-t-blue-500' : 'border-t-orange-500'}`}>
                        <CardHeader 
                            title={t.dilutionTitle} 
                            icon={Beaker} 
                            color={isHighMass ? 'text-blue-600' : 'text-orange-600'} 
                        />
                        <CardContent>
                            <div className="flex flex-col sm:flex-row sm:items-center justify-between mb-6 gap-2">
                            <span className={`px-3 py-1 rounded-full text-sm font-bold flex items-center gap-2 w-fit ${
                                isHighMass ? "bg-blue-100 text-blue-700" : "bg-orange-100 text-orange-700"
                            }`}>
                                {isHighMass ? <FlaskConical className="w-4 h-4" /> : <AlertCircle className="w-4 h-4" />}
                                {dilutionPlan.title}
                            </span>
                            <div className="text-left sm:text-right text-sm text-slate-500">
                                <p>{dilutionPlan.description}</p>
                            </div>
                            </div>
                            {dilutionPlan.isInsufficient && (
                            <div className="mb-6 bg-red-50 border border-red-200 rounded-lg p-4 flex items-start gap-3 animate-pulse">
                                <AlertTriangle className="w-6 h-6 text-red-600 shrink-0" />
                                <div>
                                <h4 className="font-bold text-red-700">{t.warnTitle}</h4>
                                <p className="text-sm text-red-600 mt-1">{t.warnDesc}</p>
                                </div>
                            </div>
                            )}
                            <div className="space-y-8">
                            {dilutionPlan.step1 && (
                                <div className="relative pl-6 border-l-2 border-slate-200">
                                <div className="absolute -left-[9px] top-0 w-4 h-4 rounded-full bg-slate-200 border-2 border-white"></div>
                                <h4 className="font-bold text-slate-700 mb-3 flex items-center gap-2">
                                    {dilutionPlan.step1.label}
                                    <span className="text-xs font-normal text-slate-500 bg-slate-100 px-2 py-0.5 rounded border border-slate-200">
                                    {dilutionPlan.step1.targetLabel}
                                    </span>
                                </h4>
                                <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <ResultBox 
                                    label={t.sourceCDNA} 
                                    value={dilutionPlan.step1.cDNA} 
                                    unit="ŒºL" 
                                    highlight={true} 
                                    warning={dilutionPlan.isInsufficient}
                                    warningText={t.warnTag}
                                    />
                                    <div className="flex items-center justify-center text-slate-400 font-bold">+</div>
                                    <ResultBox label={t.addWater} value={dilutionPlan.step1.water} unit="ŒºL" />
                                </div>
                                <div className="mt-2 text-sm text-slate-500 bg-slate-50 p-2 rounded inline-block">
                                    {t.totalVol}: {dilutionPlan.step1.total.toFixed(1)} ŒºL
                                </div>
                                </div>
                            )}
                            <div className={`relative pl-6 border-l-2 ${isHighMass ? 'border-blue-200' : 'border-orange-200'}`}>
                                <div className={`absolute -left-[9px] top-0 w-4 h-4 rounded-full border-2 border-white ${isHighMass ? 'bg-blue-500' : 'bg-orange-500'}`}></div>
                                <h4 className={`font-bold mb-3 flex items-center gap-2 ${isHighMass ? 'text-blue-800' : 'text-orange-800'}`}>
                                {dilutionPlan.step2.label}
                                <span className={`text-xs font-normal px-2 py-0.5 rounded border ${isHighMass ? 'bg-blue-50 text-blue-600 border-blue-100' : 'bg-orange-50 text-orange-600 border-orange-100'}`}>
                                    {dilutionPlan.step2.targetLabel}
                                </span>
                                </h4>
                                <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <ResultBox 
                                    label={dilutionPlan.step2.sourceName} 
                                    value={dilutionPlan.step2.sourceVol} 
                                    unit="ŒºL" 
                                    highlight={true} 
                                    warning={!dilutionPlan.step1 && dilutionPlan.isInsufficient}
                                    warningText={t.warnTag}
                                />
                                <div className="flex items-center justify-center text-slate-400 font-bold">+</div>
                                <ResultBox label={t.addWater} value={dilutionPlan.step2.water} unit="ŒºL" />
                                </div>
                                <div className={`mt-2 text-sm p-2 rounded inline-block ${isHighMass ? 'bg-blue-50 text-blue-600' : 'bg-orange-50 text-orange-600'}`}>
                                {t.totalVol}: {dilutionPlan.step2.total.toFixed(1)} ŒºL 
                                <span className="opacity-70 ml-2">({t.distributeNote} {geneCount} {t.tubes})</span>
                                </div>
                            </div>
                            </div>
                        </CardContent>
                        </Card>
                        <Card className="border-t-4 border-t-emerald-500">
                        <CardHeader title={t.mmTitle} icon={TestTube} color="text-emerald-600" />
                        <CardContent>
                            <div className="flex justify-between items-end mb-4">
                            <p className="text-sm text-slate-500">{t.mmDesc}</p>
                            <div className="text-right">
                                <span className="text-xs text-slate-400 block">{t.rxn}</span>
                                <span className="font-mono font-bold text-xl text-emerald-700">{displayRxnNum}</span>
                            </div>
                            </div>
                            <div className="overflow-hidden rounded-lg border border-slate-200">
                            <table className="w-full text-sm text-left">
                                <thead className="bg-slate-50 text-slate-600 font-semibold border-b border-slate-200">
                                <tr>
                                    <th className="px-4 py-3">{t.colComponent}</th>
                                    <th className="px-4 py-3 w-32">{t.colSingle}</th>
                                    <th className="px-4 py-3 text-right bg-emerald-50/50 text-emerald-800 w-40">{t.colTotal}</th>
                                </tr>
                                </thead>
                                <tbody className="divide-y divide-slate-100">
                                <tr>
                                    <td className="px-4 py-3 font-medium text-slate-700">2X SYBR Green</td>
                                    <td className="px-4 py-3 text-slate-500">10 ŒºL</td>
                                    <td className="px-4 py-3 text-right font-mono font-bold text-emerald-700 bg-emerald-50/30">
                                    {masterMix.sybr.toFixed(1)}
                                    </td>
                                </tr>
                                <tr>
                                    <td className="px-4 py-3 font-medium text-slate-700">F-Primer (10ŒºM)</td>
                                    <td className="px-4 py-3 text-slate-500">1 ŒºL</td>
                                    <td className="px-4 py-3 text-right font-mono font-bold text-emerald-700 bg-emerald-50/30">
                                    {masterMix.fPrimer.toFixed(1)}
                                    </td>
                                </tr>
                                <tr>
                                    <td className="px-4 py-3 font-medium text-slate-700">R-Primer (10ŒºM)</td>
                                    <td className="px-4 py-3 text-slate-500">1 ŒºL</td>
                                    <td className="px-4 py-3 text-right font-mono font-bold text-emerald-700 bg-emerald-50/30">
                                    {masterMix.rPrimer.toFixed(1)}
                                    </td>
                                </tr>
                                <tr className="bg-slate-50/80 font-bold border-t-2 border-slate-200">
                                    <td className="px-4 py-3 text-slate-800">{t.totalMixVol}</td>
                                    <td className="px-4 py-3 text-slate-500">12 ŒºL</td>
                                    <td className="px-4 py-3 text-right text-slate-800">
                                    {masterMix.totalPerGene.toFixed(1)}
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                            </div>
                            <div className="mt-4 flex gap-2 text-xs text-slate-400 items-center justify-end">
                            <Droplet className="w-3 h-3" />
                            <span>{t.footerNote}{wellVol} ŒºL cDNA + 12 ŒºL MM = {wellVol + 12} ŒºL{t.footerTotal}</span>
                            </div>
                        </CardContent>
                        </Card>
                    </div>
                    </div>
                    <footer className="text-center text-slate-400 text-sm py-6">
                    <p>¬© {new Date().getFullYear()} Laboratory qPCR Assistant v4.0</p>
                    </footer>
                </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
